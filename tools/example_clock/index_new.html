<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <style>
        svg {
            border: 1px solid #000;
        }
    </style>
    <script type="text/javascript" src="../d3.js"></script>
    <script type="text/javascript" src="api/widget.js"></script>
</head>
<div class='chart'>

</div>
<script type="text/javascript">
    // Generated by CoffeeScript 1.3.3
    (function() {
        var clockGroup, fields, height, offSetX, offSetY, pi, refresh, vis, width;

        width = 400;
        height = 200;
        offSetX = 150;
        offSetY = 100;
        pi = Math.PI;

        var ClockDat = function() {
            Widget.apply(this, arguments);
        }
        ClockDat.prototype = Object.create(Widget.prototype);
        ClockDat.prototype.constructor = ClockDat;

        ClockDat.prototype.update = function() {
            this.updateTime();
            this.bind(this.data);
        }
        ClockDat.prototype.updateTime = function() {
            var currentTime, data, hour, minute, second;
            currentTime = new Date();
            second = currentTime.getSeconds();
            minute = currentTime.getMinutes();
            hour = currentTime.getHours() + minute / 60;

            var data = this.data[0];
            data.second = second;
            data.minute = minute;
            data.hour = hour;
        }
        ClockDat.prototype.updateUI = function(g, d) {
            var sel = d3.select(g);
            sel.select('.clocksec').attr('d', this.secondD(d.second));
            sel.select('.clockmin').attr('d', this.minuteD(d.minute));
            sel.select('.clockhour').attr('d', this.hourD(d.hour));
        }
        ClockDat.prototype.destroyUI = function() {
        }
        ClockDat.prototype.enterUI = function(g, d) {
            console.log('enterUI', this, arguments);

            var selection = d3.select(g);

            selection.append('svg:path').attr('d', this.secondD(d.second))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 2).attr("class", "clocksec");
            selection.append('svg:path').attr('d', this.minuteD(d.minute))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 3).attr("class", "clockmin");
            selection.append('svg:path').attr('d', this.hourD(d.hour))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 3).attr("class", "clockhour");

            selection.append("svg:circle")
                    .attr("r", 80)
                    .attr("fill", "none")
                    .attr("class", "outercircle")
                    .attr("stroke", "black")
                    .attr("stroke-width", 2);
            selection.append("svg:circle")
                    .attr("r", 4)
                    .attr("fill", "black")
                    .attr("class", "innercircle");
        }
        ClockDat.prototype.secondD = function() {
            var scale = d3.scale.linear()
                    .domain([1, 60 + 999 / 1000])
                    .range([0, 2 * pi]);
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(70)
                    .startAngle(function(d) {
                        return scale(d);
                    })
                    .endAngle(function(d) {
                        return scale(d);
                    });
            return arc;
        }();
        ClockDat.prototype.minuteD = function() {
            var scale = d3.scale.linear()
                    .domain([0, 59 + 59 / 60])
                    .range([0, 2 * pi]);
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(70)
                    .startAngle(function(d) {
                        return scale(d);
                    })
                    .endAngle(function(d) {
                        return scale(d);
                    });
            return arc;
        }();
        ClockDat.prototype.hourD = function() {
            var scale = d3.scale.linear()
                    .domain([0, 11 + 59 / 60])
                    .range([0, 2 * pi]);;
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(50)
                    .startAngle(function(d) {
                        return scale(d % 12);
                    })
                    .endAngle(function(d) {
                        return scale(d % 12);
                    });
            return arc;
        }();

        var svg = d3.selectAll(".chart").append("svg:svg").attr("width", width).attr("height", height);
        var clock = new ClockDat(new Selection(svg, 'clock'));
        clock.data = [{position:{x:100,y:100}}];
        clock.update();

        setInterval(function() {
            clock.update();
        }, 1000);
    }).call(this);
</script>
</body>
</html>