<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
    <style>
        svg {
            border: 1px solid #000;
        }
    </style>
    <script type="text/javascript" src="../../d3.js"></script>
</head>
<body>
<div class='chart'>

</div>
<script type="text/javascript">
    // Generated by CoffeeScript 1.3.3
    (function() {
        var clockGroup, fields, height, offSetX, offSetY, pi, refresh, vis, width;

        width = 400;
        height = 200;
        offSetX = 150;
        offSetY = 100;
        pi = Math.PI;

        var ClockDat = function() {
            this.second = 0;
            this.minute = 0;
            this.hour = 0;

            this.updateTime();
        }
        ClockDat.prototype.updateTime = function() {
            var currentTime, data, hour, minute, second;
            currentTime = new Date();
            second = currentTime.getSeconds();
            minute = currentTime.getMinutes();
            hour = currentTime.getHours() + minute / 60;

            this.second = second;
            this.minute = minute;
            this.hour = hour;
        }
        ClockDat.prototype.update = function() {
            this.updateTime();
            this.updateUI();
        }
        ClockDat.prototype.updateUI = function() {
            this.secondSelect.attr('d', this.secondD(this.second));
            this.minuteSelect.attr('d', this.minuteD(this.minute));
            this.hourSelect.attr('d', this.hourD(this.hour));
        }
        ClockDat.prototype.destroyUI = function() {
        }
        ClockDat.prototype.initUI = function(g) {
            console.log('initUI', this, arguments);

            var selection = d3.select(g);
            this.secondSelect = selection.append('svg:path').attr('d', this.secondD(this.second))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 2);
            this.minuteSelect = selection.append('svg:path').attr('d', this.minuteD(this.minute))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 3);
            this.hourSelect = selection.append('svg:path').attr('d', this.hourD(this.hour))
                    .attr("fill", "none").attr("stroke", "black").attr("stroke-width", 3);

            selection.append("svg:circle")
                    .attr("r", 80)
                    .attr("fill", "none")
                    .attr("class", "clock outercircle")
                    .attr("stroke", "black")
                    .attr("stroke-width", 2);
            selection.append("svg:circle")
                    .attr("r", 4)
                    .attr("fill", "black")
                    .attr("class", "clock innercircle");
        }
        ClockDat.prototype.secondD = function() {
            var scale = d3.scale.linear()
                    .domain([1, 60 + 999 / 1000])
                    .range([0, 2 * pi]);
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(70)
                    .startAngle(function(d) {
                        return scale(d);
                    })
                    .endAngle(function(d) {
                        return scale(d);
                    });
            return arc;
        }();
        ClockDat.prototype.minuteD = function() {
            var scale = d3.scale.linear()
                    .domain([0, 59 + 59 / 60])
                    .range([0, 2 * pi]);
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(70)
                    .startAngle(function(d) {
                        return scale(d);
                    })
                    .endAngle(function(d) {
                        return scale(d);
                    });
            return arc;
        }();
        ClockDat.prototype.hourD = function() {
            var scale = d3.scale.linear()
                    .domain([0, 11 + 59 / 60])
                    .range([0, 2 * pi]);;
            var arc = d3.svg.arc()
                    .innerRadius(0)
                    .outerRadius(50)
                    .startAngle(function(d) {
                        return scale(d % 12);
                    })
                    .endAngle(function(d) {
                        return scale(d % 12);
                    });
            return arc;
        }();

        var clock = new ClockDat();

        function customer(d, i, nindex) {
            d.initUI(this);
        }

        var svg = d3.selectAll(".chart").append("svg:svg").attr("width", width).attr("height", height);
        svg.selectAll(".clockhand")
                .data([clock])
                .enter()
                .append("svg:g")
                .attr("transform", "translate(" + offSetX + "," + offSetY + ")")
                .each(customer);

        setInterval(function() {
            clock.update();
        }, 1000);
    }).call(this);
</script>
</body>
</html>