<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
    <style>
        svg {
            border: 1px solid #000;
        }
    </style>
    <script type="text/javascript" src="../../d3.js"></script>
</head>
<body>
<div class='chart'>

</div>
<script type="text/javascript">
    // Generated by CoffeeScript 1.3.3
    (function() {
        var clockGroup, fields, height, offSetX, offSetY, pi, refresh, scaleHours, scaleMins, scaleSecs, vis, width;

        width = 400;
        height = 200;
        offSetX = 150;
        offSetY = 100;
        pi = Math.PI;
        scaleSecs = d3.scale.linear().domain([1, 60 + 999 / 1000]).range([0, 2 * pi]);
        scaleMins = d3.scale.linear().domain([0, 59 + 59 / 60]).range([0, 2 * pi]);
        scaleHours = d3.scale.linear().domain([0, 11 + 59 / 60]).range([0, 2 * pi]);

        var ClockDat = function() {
            this.second = 0;
            this.minute = 0;
            this.hour = 0;

            this.updateTime();
        }
        ClockDat.prototype.updateTime = function() {
            var currentTime, data, hour, minute, second;
            currentTime = new Date();
            second = currentTime.getSeconds();
            minute = currentTime.getMinutes();
            hour = currentTime.getHours() + minute / 60;

            this.second = second;
            this.minute = minute;
            this.hour = hour;
        }
        ClockDat.prototype.update = function() {
            this.updateTime();
            this.updateUI();
        }
        ClockDat.prototype.updateUI = function() {
            if(this.secondArc) {
                var arc = scaleSecs(this.second);
                this.secondArc.startAngle(arc);
                this.secondArc.endAngle(arc);
            }
            if(this.minuteArc) {
                var arc = scaleMins(this.minute);
                this.minuteArc.startAngle(arc);
                this.minuteArc.endAngle(arc);
            }
            if(this.hourArc) {
                var arc = scaleHours(d.numeric % 12);
                this.hourArc.startAngle(arc);
                this.hourArc.endAngle(arc);
            }
        }
        ClockDat.prototype.initUI = function(container) {
            console.log('initUI');
            console.log(arguments);
//            this.secondArc = wrap(d3.svg.arc(), {
//                innerRadius : 0,
//                outerRadius : 70
//            });
//            this.minuteArc = wrap(d3.svg.arc(), {
//                innerRadius : 0,
//                outerRadius : 70
//            });
//            this.hourArc = wrap(d3.svg.arc(), {
//                innerRadius : 0,
//                outerRadius : 50
//            });
//            container.append(this.secondArc);
//            container.append(this.minuteArc);
//            container.append(this.hourArc);
        }

        var clockdata = new ClockDat();

        function wrap(node, attrs) {
            for(var i in attrs) {
//                node.attr(i, attrs[i]);
            }
            return node;
        }

        var diventer = d3.select("body").selectAll("div")
                .data([4, 8, 15, 16, 23, 42])
                .enter();
        console.log(diventer);
        diventer.append("div").text(function(d) { return d; });

        var con = d3.selectAll(".chart").data([clockdata]);
        console.log(con);
        var enter = con.enter();
        console.log(enter);
        console.log('----------------------------');
        enter.call(clockdata.initUI);
        console.log('----------------------------');
        enter.each(clockdata.initUI);
//                    .each(clockdata.initUI);
//        var container = wrap(vis.append("svg:g"), {
//            'transform' : "translate(" + offSetX + "," + offSetY + ")"
//        });
//        container.each(clockdata.initUI);

//        clockGroup = wrap(vis.append("svg:g"), {
//            'transform' : "translate(" + offSetX + "," + offSetY + ")"
//        }).data([clockdata]).enter().call(clockdata.initUI);
//
//        wrap(clockGroup.append("svg:circle"), {
//            'r' : 80,
//            'fill' : 'none',
//            'class' : 'clock outercircle',
//            'stroke' : 'black',
//            'stroke-width' : 2
//        });
//        wrap(clockGroup.append("svg:circle"), {
//            'r' : 4,
//            'fill' : 'black',
//            'class' : 'clock innercircle'
//        });
//
//        refresh = function(data) {
//            var hourArc, minuteArc, secondArc;
//            clockGroup.selectAll(".clockhand").remove();
//            var enter = clockGroup.selectAll(".clockhand")
//                    .data(clockdata)
//                    .enter();
//            enter.call(clockdata.initUI);
//            var a = 0;
//        };
//        refresh();
//
//        setInterval(function() {
//            clockdata.update();
//        }, 1000);

    }).call(this);
</script>
</body>
</html>